-- B1: Tạo bảng + PK
CREATE TABLE CHUYENBAY
(
	MACHUYENBAY VARCHAR(50) NOT NULL,
	MATUYENBAY VARCHAR(50) NOT NULL,
	NGAYBAY DATE NOT NULL,
	GIOBAY TIME NOT NULL,
	THOIGIANBAY INT NOT NULL,
	SOGHE INT NOT NULL,
	CONSTRAINT PK_MACHUYENBAY PRIMARY KEY (MACHUYENBAY)
);

CREATE TABLE SANBAY
(
	MASANBAY VARCHAR(50) NOT NULL,
	TENSANBAY VARCHAR(50) NOT NULL,
	DIACHISANBAY VARCHAR(50) NOT NULL,
	CONSTRAINT PK_SANBAY PRIMARY KEY (MASANBAY)
);


CREATE TABLE TUYENBAY
(
	MATUYENBAY VARCHAR(50) NOT NULL,
	SANBAYDI VARCHAR(50) NOT NULL,
	SANBAYDEN VARCHAR(50) NOT NULL,
	THOIGIANBAY INT NOT NULL,
	SOGHE INT NOT NULL,
	CONSTRAINT PK_TUYENBAY PRIMARY KEY (MATUYENBAY)
);

CREATE TABLE SANBAYTRUNGGIAN
(
	MACHUYENBAY VARCHAR(50) NOT NULL,
	MASANBAYTRUNGGIAN VARCHAR(50) NOT NULL,
	THOIGIANDUNG INT NOT NULL,
	GHICHU VARCHAR(50),
	CONSTRAINT PK_SANBAYTRUNGGIAN PRIMARY KEY (MACHUYENBAY, MASANBAYTRUNGGIAN)
);

CREATE TABLE HANGVE
(
	MAHANGVE VARCHAR(50) NOT NULL,
	TENHANGVE VARCHAR(50) NOT NULL,
	CONSTRAINT PK_HANGVE PRIMARY KEY (MAHANGVE)
);

CREATE TABLE THONGKEHANGVE
(
	MACHUYENBAY VARCHAR(50) NOT NULL,
	MAHANGVE VARCHAR(50) NOT NULL,
	SOGHETRONG INT NOT NULL,
	SOGHEDAT INT NOT NULL,
	CONSTRAINT PK_THONGKEHANGVE PRIMARY KEY (MACHUYENBAY, MAHANGVE)
);

CREATE TABLE DONGIA
(
	MATUYENBAY VARCHAR(50) NOT NULL,
	MAHANGVE VARCHAR(50) NOT NULL,
	GIATIEN INT NOT NULL,
	CONSTRAINT PK_DONGIA PRIMARY KEY (MATUYENBAY, MAHANGVE)
);

CREATE TABLE TAIKHOANNHANVIEN
(
	IDNHANVIEN VARCHAR(50) NOT NULL,
	TENTAIKHOAN VARCHAR(200) NOT NULL,
	MATKHAU VARCHAR(200) NOT NULL,
	TENNHANVIEN VARCHAR(50) NOT NULL,
	CMND_CCCD VARCHAR(50) NOT NULL,
	NGAYSINH DATE NOT NULL,
	GIOITINH VARCHAR(3) NOT NULL,
	CONSTRAINT PK_NHANVIEN PRIMARY KEY (IDNHANVIEN)
);

CREATE TABLE PHIEUDATCHO_VEMAYBAY
(
	MAVE VARCHAR(50) NOT NULL,
	MACHUYENBAY VARCHAR(50) NOT NULL,
	-- Thông tin Hành khách
	TENHANHKHACH VARCHAR(50) NOT NULL,
	CMND_CCCD VARCHAR(50) NOT NULL,
	GIOITINH VARCHAR(3) NOT NULL,
	-- Thông tin vé
	MAHANGVE VARCHAR(50) NOT NULL,
	GIATIEN BIGINT NOT NULL,
	NGAYDAT DATE NOT NULL,
	TRANGTHAI BOOLEAN NOT NULL,
	-- Thông tin nhân viên
	IDNHANVIEN VARCHAR(50) NOT NULL,
	CONSTRAINT PK_PHIEUDATCHO_VEMAYBAY PRIMARY KEY (MAVE)
); -- Tới đây

------------------------------------------------

-- THÊM FK + Ràng buộc
-- Bảng CHUYENBAY
ALTER TABLE CHUYENBAY
    ADD CONSTRAINT FK_CHUYENBAY_TUYENBAY
    FOREIGN KEY (MATUYENBAY)
    REFERENCES TUYENBAY(MATUYENBAY);

-- Bảng SANBAY

-- Bảng TUYENBAY
ALTER TABLE TUYENBAY
    ADD CONSTRAINT FK_TUYENBAY_SANBAYDI
    FOREIGN KEY (SANBAYDI)
    REFERENCES SANBAY(MASANBAY);

ALTER TABLE TUYENBAY
    ADD CONSTRAINT FK_TUYENBAY_SANBAYDEN
    FOREIGN KEY (SANBAYDEN)
    REFERENCES SANBAY(MASANBAY);

-- alter table PHIM
-- 	add constraint CK_PHIM_NAMSX
-- 	check (NAMSX <= year(getdate()))

-- Bảng SANBAYTRUNGGIAN
ALTER TABLE SANBAYTRUNGGIAN
    ADD CONSTRAINT FK_SANBAYTRUNGGIAN_CHUYENBAY
    FOREIGN KEY (MACHUYENBAY)
    REFERENCES CHUYENBAY(MACHUYENBAY);

ALTER TABLE SANBAYTRUNGGIAN
    ADD CONSTRAINT FK_SANBAYTRUNGGIAN_SANBAY
    FOREIGN KEY (MASANBAYTRUNGGIAN)
    REFERENCES SANBAY(MASANBAY);

-- ALTER TABLE PHIM
--     ADD CONSTRAINT CK_PHIM_NAMSX
--     CHECK (NAMSX <= EXTRACT(YEAR FROM CURRENT_DATE));

-- Bảng HANGVE

-- Bảng THONGKEHANGVE 
ALTER TABLE THONGKEHANGVE
    ADD CONSTRAINT FK_THONGKEHANGVE_CHUYENBAY
    FOREIGN KEY (MACHUYENBAY)
    REFERENCES CHUYENBAY(MACHUYENBAY);

ALTER TABLE THONGKEHANGVE
    ADD CONSTRAINT FK_THONGKEHANGVE_HANGVE
    FOREIGN KEY (MAHANGVE)
    REFERENCES HANGVE(MAHANGVE);

-- Bảng DONGIA
ALTER TABLE DONGIA
    ADD CONSTRAINT FK_DONGIA_TUYENBAY
    FOREIGN KEY (MATUYENBAY)
    REFERENCES TUYENBAY(MATUYENBAY);

ALTER TABLE DONGIA
    ADD CONSTRAINT FK_DONGIA_HANGVE
    FOREIGN KEY (MAHANGVE)
    REFERENCES HANGVE(MAHANGVE);

-- ALTER TABLE DAODIEN
--     ADD CONSTRAINT FK_DAODIEN_PHAI
--     CHECK (PHAI IN ('Nam', 'Nữ'));

-- alter table DAODIEN
-- 	add constraint FK_DAODIEN_NAMSINH
-- 	check (year(getdate()) - NAMSINH >= 18)

-- Bảng TAIKHOANNHANVIEN

-- Bảng PHIEUDATCHO_VEMAYBAY
ALTER TABLE PHIEUDATCHO_VEMAYBAY
    ADD CONSTRAINT FK_PHIEUDATCHO_VEMAYBAY_CHUYENBAY
    FOREIGN KEY (MACHUYENBAY)
    REFERENCES CHUYENBAY(MACHUYENBAY);

ALTER TABLE PHIEUDATCHO_VEMAYBAY
    ADD CONSTRAINT FK_PHIEUDATCHO_VEMAYBAY_HANGVE
    FOREIGN KEY (MAHANGVE)
    REFERENCES HANGVE(MAHANGVE);

ALTER TABLE PHIEUDATCHO_VEMAYBAY
    ADD CONSTRAINT FK_PHIEUDATCHO_VEMAYBAY_TAIKHOANNHANVIEN
    FOREIGN KEY (IDNHANVIEN)
    REFERENCES TAIKHOANNHANVIEN(IDNHANVIEN);

-- ALTER TABLE DIENVIEN
--     ADD CONSTRAINT FK_DIENVIEN_PHAI
--     CHECK (PHAI IN ('Nam', 'Nữ'));

--------------------------------------------
-- Nhập DL
-- Bảng SANBAY
INSERT INTO SANBAY VALUES
	('SB01', 'Tân Sơn Nhất', 'TP.HCM'),
	('SB02', 'Nội Bài', 'Hà Nội'),
	('SB03', 'Đà Nẵng', 'Đà Nẵng'),
	('SB04', 'Cần Thơ', 'Cần Thơ'),
	('SB05', 'Cam Ranh', 'Khánh Hòa'),
	('SB06', 'Phú Quốc', 'Kiên Giang'),
	('SB07', 'Vinh', 'Nghệ An'),
	('SB08', 'Chu Lai', 'Quảng Nam'),
	('SB09', 'Pleiku', 'Gia Lai'),
	('SB10', 'Liên Khương', 'Lâm Đồng');

-- Bảng HANGVE
INSERT INTO HANGVE VALUES
	('HV01', 'Phổ thông'),
	('HV02', 'Thương gia'),
	('HV03', 'Hạng nhất');

-- Bảng TAIKHOANNHANVIEN
INSERT INTO TAIKHOANNHANVIEN VALUES
	('NV01', 'user1', 'pass1', 'Nguyễn Văn A', '123456789', '1990-01-01', 'Nam'),
	('NV02', 'user2', 'pass2', 'Trần Thị B', '987654321', '1992-05-12', 'Nữ'),
	('NV03', 'user3', 'pass3', 'Lê Văn C', '456789123', '1985-03-20', 'Nam'),
	('NV04', 'user4', 'pass4', 'Phạm Thị D', '654321987', '1995-07-15', 'Nữ'),
	('NV05', 'user5', 'pass5', 'Hoàng Văn E', '111222333', '1988-09-25', 'Nam');

-- Bảng TUYENBAY
INSERT INTO TUYENBAY VALUES
	('TB01', 'SB01', 'SB02', 120, 150),
	('TB02', 'SB02', 'SB01', 120, 150),
	('TB03', 'SB01', 'SB03', 90, 120),
	('TB04', 'SB03', 'SB01', 90, 120),
	('TB05', 'SB02', 'SB03', 100, 130),
	('TB06', 'SB03', 'SB02', 100, 130),
	('TB07', 'SB01', 'SB04', 80, 100),
	('TB08', 'SB04', 'SB01', 80, 100),
	('TB09', 'SB02', 'SB04', 95, 120),
	('TB10', 'SB04', 'SB02', 95, 120),
	('TB11', 'SB01', 'SB05', 60, 90),
	('TB12', 'SB05', 'SB01', 60, 90),
	('TB13', 'SB06', 'SB01', 85, 100),
	('TB14', 'SB01', 'SB06', 85, 100),
	('TB15', 'SB07', 'SB02', 70, 100),
	('TB16', 'SB02', 'SB07', 70, 100),
	('TB17', 'SB08', 'SB03', 60, 80),
	('TB18', 'SB03', 'SB08', 60, 80),
	('TB19', 'SB09', 'SB02', 110, 120),
	('TB20', 'SB02', 'SB09', 110, 120);

-- Bảng CHUYENBAY
INSERT INTO CHUYENBAY VALUES
	('CB01', 'TB01', '2025-05-01', '08:00:00', 120, 150),
	('CB02', 'TB03', '2025-05-02', '10:00:00', 90, 120),
	('CB03', 'TB05', '2025-05-03', '12:00:00', 100, 130),
	('CB04', 'TB07', '2025-05-04', '14:00:00', 80, 100),
	('CB05', 'TB09', '2025-05-05', '16:00:00', 95, 120),
	('CB06', 'TB11', '2025-05-06', '09:00:00', 60, 90),
	('CB07', 'TB13', '2025-05-07', '11:00:00', 85, 100),
	('CB08', 'TB15', '2025-05-08', '13:00:00', 70, 100),
	('CB09', 'TB17', '2025-05-09', '15:00:00', 60, 80),
	('CB10', 'TB19', '2025-05-10', '17:00:00', 110, 120);

-- Bảng SANBAYTRUNGGIAN
INSERT INTO SANBAYTRUNGGIAN VALUES
	('CB01', 'SB03', 30, 'Dừng kỹ thuật'),
	('CB02', 'SB04', 20, 'Dừng ngắn'),
	('CB03', 'SB05', 25, 'Tiếp nhiên liệu'),
	('CB04', 'SB06', 15, NULL),
	('CB05', 'SB07', 30, 'Chờ slot'),
	('CB06', 'SB08', 10, NULL),
	('CB07', 'SB09', 20, NULL),
	('CB08', 'SB10', 25, 'Kỹ thuật'),
	('CB09', 'SB02', 15, 'Dừng khách'),
	('CB10', 'SB01', 20, NULL);

-- Bảng THONGKEHANGVE
INSERT INTO THONGKEHANGVE VALUES
	('CB01', 'HV01', 100, 50),
	('CB01', 'HV02', 30, 15),
	('CB01', 'HV03', 20, 5),
	('CB02', 'HV01', 90, 60),
	('CB03', 'HV01', 110, 70),
	('CB04', 'HV01', 80, 50),
	('CB05', 'HV01', 85, 40),
	('CB06', 'HV01', 70, 60),
	('CB07', 'HV02', 50, 20),
	('CB08', 'HV02', 60, 40),
	('CB09', 'HV02', 55, 30),
	('CB10', 'HV03', 45, 20),
	('CB02', 'HV03', 30, 10),
	('CB03', 'HV02', 60, 35),
	('CB04', 'HV03', 40, 25);

-- Bảng DONGIA
INSERT INTO DONGIA VALUES
	('TB01', 'HV01', 1500000),
	('TB01', 'HV02', 2500000),
	('TB01', 'HV03', 4000000),
	('TB03', 'HV01', 1200000),
	('TB03', 'HV02', 2200000),
	('TB03', 'HV03', 3700000),
	('TB05', 'HV01', 1300000),
	('TB07', 'HV01', 1100000),
	('TB09', 'HV01', 1400000),
	('TB11', 'HV01', 1000000),
	('TB13', 'HV01', 1250000),
	('TB15', 'HV01', 1350000),
	('TB17', 'HV01', 1150000),
	('TB19', 'HV01', 1450000),
	('TB20', 'HV02', 2550000);

-- Bảng PHIEUDATCHO_VEMAYBAY
INSERT INTO PHIEUDATCHO_VEMAYBAY VALUES
	('VE01', 'CB01', 'Lê Thanh Tùng', '123456789', 'Nam', 'HV01', 1500000, '2025-04-01', true, 'NV01'),
	('VE02', 'CB01', 'Nguyễn Thị Hoa', '234567891', 'Nữ', 'HV02', 2500000, '2025-04-01', false, 'NV02'),
	('VE03', 'CB02', 'Trần Văn Hùng', '345678912', 'Nam', 'HV03', 3700000, '2025-04-02', true, 'NV03'),
	('VE04', 'CB03', 'Phạm Thị Tuyết', '456789123', 'Nữ', 'HV01', 1300000, '2025-04-02', true, 'NV01'),
	('VE05', 'CB04', 'Lê Anh Dũng', '567891234', 'Nam', 'HV02', 2200000, '2025-04-03', false, 'NV05'),
	('VE06', 'CB05', 'Nguyễn Thị Lan', '678912345', 'Nữ', 'HV01', 1400000, '2025-04-03', true, 'NV04'),
	('VE07', 'CB06', 'Võ Văn Bình', '789123456', 'Nam', 'HV01', 1000000, '2025-04-04', true, 'NV03'),
	('VE08', 'CB07', 'Trần Thị Hương', '891234567', 'Nữ', 'HV01', 1250000, '2025-04-04', true, 'NV02'),
	('VE09', 'CB08', 'Nguyễn Minh Châu', '912345678', 'Nam', 'HV01', 1350000, '2025-04-05', false, 'NV01'),
	('VE10', 'CB09', 'Lê Văn Lộc', '132456789', 'Nam', 'HV01', 1150000, '2025-04-05', true, 'NV04'),
	('VE11', 'CB10', 'Đặng Thị Lệ', '123654789', 'Nữ', 'HV01', 1450000, '2025-04-06', true, 'NV05'),
	('VE12', 'CB01', 'Lưu Văn Nam', '159753486', 'Nam', 'HV02', 2500000, '2025-04-06', true, 'NV01'),
	('VE13', 'CB02', 'Đinh Thị Hà', '123789456', 'Nữ', 'HV03', 3700000, '2025-04-07', true, 'NV02'),
	('VE14', 'CB03', 'Phạm Minh Hoàng', '456123789', 'Nam', 'HV01', 1300000, '2025-04-07', true, 'NV03'),
	('VE15', 'CB04', 'Nguyễn Thị Mai', '789456123', 'Nữ', 'HV01', 1100000, '2025-04-08', false, 'NV04'),
	('VE16', 'CB05', 'Lê Ngọc Trâm', '321654987', 'Nữ', 'HV01', 1400000, '2025-04-08', true, 'NV05'),
	('VE17', 'CB06', 'Phan Văn Tuấn', '741852963', 'Nam', 'HV01', 1000000, '2025-04-09', true, 'NV01'),
	('VE18', 'CB07', 'Nguyễn Thị Kim', '852963741', 'Nữ', 'HV01', 1250000, '2025-04-09', false, 'NV02'),
	('VE19', 'CB08', 'Đỗ Mạnh Cường', '963741852', 'Nam', 'HV01', 1350000, '2025-04-10', true, 'NV03'),
	('VE20', 'CB09', 'Lê Thị Dung', '321789654', 'Nữ', 'HV01', 1150000, '2025-04-10', true, 'NV04');



